<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Stock Predictor 종목 상세 페이지" />
    <meta name="keywords" content="주식, 투자, Stock Predictor" />
    <meta name="author" content="Jo YoungRan" />
    <title>종목 상세 - Stock Predictor</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/common.css" />
    <link rel="stylesheet" href="/css/stock-detail.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>

    <script src="/js/stock-detail.js"></script>
    <script src="/js/nav.js"></script>

    <meta name="_csrf" th:content="${_csrf.token}">
    <meta name="_csrf_header" th:content="${_csrf.headerName}">
</head>
<body>
<header>
    <div th:replace="~{fragments/nav :: nav}"></div>
</header>

<main class="container py-4">

    <!-- 상단 종목 정보 -->
    <section class="mb-4 d-flex justify-content-between align-items-center flex-wrap">
        <div>
            <h2 class="mb-1" th:text="${stock.name} + ' (' + ${stock.ticker} + ')'"></h2>
        </div>
        <button
            class="btn btn-outline-warning favorite-btn"
            th:classappend="${isFavorite} ? ' active' : ''"
            th:data-ticker="${stock.ticker}">
            ⭐ 즐겨찾기
        </button>
    </section>

    <!-- 가격 차트 -->
    <section class="mb-4" id="chartSection" th:data-ticker="${stock.ticker}">
        <h4 class="mb-3">📈 가격 차트</h4>
        <ul class="nav nav-tabs mb-2" id="chartTab" role="tablist">
            <li class="nav-item">
                <button class="nav-link active" id="week-tab" data-period="week" data-bs-toggle="tab">1주</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="month-tab" data-period="month" data-bs-toggle="tab">1개월</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="year-tab" data-period="year" data-bs-toggle="tab">1년</button>
            </li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane fade show active chart-area" id="chart">
                <canvas id="candleChart"></canvas>
            </div>
        </div>
        <div id="detailPanel" style="margin-top:10px;"></div>
        <button id="helpBtn" class="btn btn-outline-info btn-sm mt-2">📘 캔들 보는 법</button>
        <button id="resetZoomBtn" class="btn btn-outline-info btn-sm mt-2">🔄 줌 초기화</button>

        <div id="helpCard" class="card shadow-sm mt-2" style="display:none;">
            <div class="card-body small">
                <strong>캔들 해석 가이드</strong>
                <ul class="mb-0">
                    <li>본체(직사각형): 시가~종가</li>
                    <li>윗꼬리/아랫꼬리: 고가/저가</li>
                    <li>색상: 상승(초록) / 하락(빨강)</li>
                    <li>거래량: 가격 움직임의 신뢰도</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- 가치평가 지표 -->
    <section class="mb-4">
        <h4 class="mb-3">💹 가치평가 지표</h4>
        <div class="indicator-card d-flex flex-wrap gap-3">
            <span>PER: 12.3</span>
            <span>PBR: 1.1</span>
            <span>ROE: 15%</span>
            <span>EV/EBITDA: 8.5</span>
        </div>
    </section>

    <!-- 예상 주가 (확률 기반) -->
    <section class="mb-4">
        <h4 class="mb-3">🔮 예상 주가 (확률 기반)</h4>
        <div class="row g-3">

            <!-- 내일 예측 -->
            <div class="col-md-6 col-lg-4">
                <div class="card shadow-sm h-100">
                    <div class="card-body">
                        <h6 class="card-title">2025-08-20 예측</h6>
                        <p class="mb-2 small text-muted">모델: LSTM</p>

                        <label class="fw-bold">상승 확률</label>
                        <div class="progress mb-2">
                            <div class="progress-bar bg-success" role="progressbar"
                                 style="width: 65%;">65%</div>
                        </div>

                        <label class="fw-bold">하락 확률</label>
                        <div class="progress">
                            <div class="progress-bar bg-danger" role="progressbar"
                                 style="width: 35%;">35%</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 1주 후 예측 -->
            <div class="col-md-6 col-lg-4">
                <div class="card shadow-sm h-100">
                    <div class="card-body">
                        <h6 class="card-title">2025-08-27 예측</h6>
                        <p class="mb-2 small text-muted">모델: Prophet</p>

                        <label class="fw-bold">상승 확률</label>
                        <div class="progress mb-2">
                            <div class="progress-bar bg-success" role="progressbar"
                                 style="width: 55%;">55%</div>
                        </div>

                        <label class="fw-bold">하락 확률</label>
                        <div class="progress">
                            <div class="progress-bar bg-danger" role="progressbar"
                                 style="width: 45%;">45%</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 1개월 후 예측 -->
            <div class="col-md-6 col-lg-4">
                <div class="card shadow-sm h-100">
                    <div class="card-body">
                        <h6 class="card-title">2025-09-19 예측</h6>
                        <p class="mb-2 small text-muted">모델: XGBoost</p>

                        <label class="fw-bold">상승 확률</label>
                        <div class="progress mb-2">
                            <div class="progress-bar bg-success" role="progressbar"
                                 style="width: 40%;">40%</div>
                        </div>

                        <label class="fw-bold">하락 확률</label>
                        <div class="progress">
                            <div class="progress-bar bg-danger" role="progressbar"
                                 style="width: 60%;">60%</div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </section>

    <!-- 나의 메모 -->
    <section class="mb-4">
        <h4 class="mb-3">📝 나의 메모</h4>

        <!-- 새 메모 작성 박스 -->
        <div class="memo-box mb-3">
            <textarea placeholder="새 메모를 작성하세요..."></textarea>
            <div class="text-end mt-2">
                <button class="btn btn-primary btn-sm">저장</button>
            </div>
        </div>

        <!-- 기존 메모 카드 목록 (하드코딩 예시) -->
        <div class="row g-3">
            <!-- 메모 1 -->
            <div class="col-md-6 col-lg-4">
                <div class="card shadow-sm h-100 bg-dark text-white border-light memo-card">
                    <div class="card-body">
                        <h5 class="card-title">삼성전자 분석</h5>
                        <h6 class="card-subtitle mb-2">2025-08-17</h6>
                        <p class="card-text">2분기 실적이 예상보다 양호. 반도체 부문 회복세 뚜렷, 매수 의견 유지.</p>
                        <button class="btn btn-sm btn-outline-primary">자세히 보기</button>
                    </div>
                </div>
            </div>

            <!-- 메모 2 -->
            <div class="col-md-6 col-lg-4">
                <div class="card shadow-sm h-100 bg-dark text-white border-light memo-card">
                    <div class="card-body">
                        <h5 class="card-title">카카오 주가 전망</h5>
                        <h6 class="card-subtitle mb-2">2025-08-15</h6>
                        <p class="card-text">신규 서비스 런칭에 따른 주가 변동 가능성 검토. 단기 리스크 관리 필요.</p>
                        <button class="btn btn-sm btn-outline-primary">자세히 보기</button>
                    </div>
                </div>
            </div>

            <!-- 메모 3 -->
            <div class="col-md-6 col-lg-4">
                <div class="card shadow-sm h-100 bg-dark text-white border-light memo-card">
                    <div class="card-body">
                        <h5 class="card-title">현대차 리서치</h5>
                        <h6 class="card-subtitle mb-2">2025-08-10</h6>
                        <p class="card-text">전기차 라인업 확대와 유럽 시장 진출 가속화. 장기적 성장 기대.</p>
                        <button class="btn btn-sm btn-outline-primary">자세히 보기</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

</main>

<div th:replace="~{fragments/footer :: footer}"></div>

<!-- 로그아웃 확인 모달 -->
<div th:replace="~{fragments/logout-modal :: logoutModal}"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
